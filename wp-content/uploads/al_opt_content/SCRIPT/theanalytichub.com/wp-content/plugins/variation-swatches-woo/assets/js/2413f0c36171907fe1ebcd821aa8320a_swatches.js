!function(o){var t=cfvsw_swatches_settings.remove_attr_class;let a=t+" cfvsw-swatches-out-of-stock",c=t+"-disable",n=c+" cfvsw-swatches-disabled",l={init:()=>{cfvsw_swatches_settings.disable_out_of_stock&&(l.firstTime(),l.Events())},firstTime:()=>{var t=o("table.variations").not(".cfvsw-variation-disable-logic");t.addClass("cfvsw-variation-disable-logic"),t.each(function(){var t=o(this).closest("[data-product_id][data-product_variations]"),a=t.data("product_variations");l.swatchesOptions(t,a)})},chooseOption(){var t=o(this),a=t.closest("[data-product_id][data-product_variations]"),t=(a.find(".disable-to-select").removeClass("disable-to-select"),t.closest("td")),t=(""!==t.find(".cfvsw-hidden-select select").val()&&t.addClass("disable-to-select"),a.data("product_variations"));l.swatchesOptions(a,t)},getSelectedOptions:t=>{t=t.find(".cfvsw-hidden-select select");let s={};return t.each(function(){var t=o(this),a=t.val(),t=t.attr("data-attribute_name");""!==a&&""!==t&&(s[t]=a)}),s},swatchesOptions:(t,i)=>{var a=t.find("td").not(".disable-to-select"),s=a.find(".cfvsw-swatches-container[swatches-attr]");if(s.length){let e=l.getSelectedOptions(t);t=a.find("."+c);t.length&&t.removeClass(n),s.each(function(){var t=o(this);let s=t.attr("swatches-attr");""!==s&&t.find(".cfvsw-swatches-option").each(function(){var t=o(this),a=t.attr("data-slug");a&&""!==a&&!l.checkOptionAvail(s,a,e,i)&&t.addClass(n)})})}},checkOptionAvail:(a,s,e,i)=>{let c;for(let t=0;t<i.length;t++){var{attributes:n,is_in_stock:o}=i[t];if(l.checkInPreRawData(e,n,a,s,o)){c=o;break}}return c},checkInPreRawData:(t,a,s,e,i)=>{var c={...t},t=Object.keys(t),n=t.indexOf(s),o={};return o[s]=e,0<=n&&(t.splice(n,1),delete c[s]),l.checkInRawData(a,c,o,i)},checkInRawData:(t,a,s,e)=>{var i,c={...t},n={...a,...s};let o=!0;for(i in n){var l=n[i],r=t[i];""===r?delete c[i]:l===r?delete c[i]:o=!1}if(!e)for(var d in c)""!==c[d]&&(o=!1);return o},Events:()=>{o(document).on("click",".cfvsw-swatches-container .cfvsw-swatches-option[data-slug]",l.chooseOption)}};function s(){o(".cfvsw_variations_form:not(.variation-function-added)").each(function(){let n=o(this);n.addClass("variation-function-added"),n.wc_variation_form(),n.on("found_variation",function(t,e){var a,s=n,i=e.image,c=(s=s.closest("li")).find("img:first");if(0===s.find(".cfvsw-original-thumbnail").length&&(a=c.clone(),c.after('<span class="cfvsw-original-thumbnail"></span>'),s.find(".cfvsw-original-thumbnail").html(a)),c.attr("src",i.thumb_src),c.attr("srcset",""),!n.attr("data-cfvsw-catalog")){s=n,0!==(a=e).price_html.length&&(s.parents("li").find(".cfvsw-original-price").length?s.parents("li").find(".price").replaceWith(a.price_html):((s=s.parents("li").find(".price")).after(a.price_html),s.removeClass("price").addClass("cfvsw-original-price")));{i=n,c=e;let t=i.find(".variations select"),s={},a=i.parents("li").find(".cfvsw_ajax_add_to_cart");t.each(function(){var t=o(this).data("attribute_name")||o(this).attr("name"),a=o(this).val()||"";s[t]=a}),a.html(a.data("add_to_cart_text")),a.addClass("cfvsw_variation_found"),a.attr("data-variation_id",c.variation_id),a.attr("data-selected_variant",JSON.stringify(s))}}})})}o(document).on("click",".cfvsw-swatches-option",function(){var t=o(this);if(!t.hasClass("cfvsw-swatches-disabled")&&!t.hasClass("cfvsw-swatches-out-of-stock")){if(t.hasClass("cfvsw-selected-swatch")){t.removeClass("cfvsw-selected-swatch");{var a=t;a.parents("li").find(".cfvsw-original-price").length&&(a.parents("li").find(".price").remove(),a.parents("li").find(".cfvsw-original-price").removeClass("cfvsw-original-price").addClass("price"))}{a=t;a=a.closest("li");a.find(".cfvsw-original-thumbnail").length&&(a.find("img:first").replaceWith(a.find(".cfvsw-original-thumbnail").html()),a.find(".cfvsw-original-thumbnail").remove())}{a=t;a=a.parents("li").find(".cfvsw_ajax_add_to_cart");a.html(a.data("select_options_text")),a.removeClass("cfvsw_variation_found"),a.attr("data-variation_id",""),a.attr("data-selected_variant","")}}else t.parent().find(".cfvsw-swatches-option").each(function(){o(this).removeClass("cfvsw-selected-swatch")}),t.addClass("cfvsw-selected-swatch");var a=t,s=a.hasClass("cfvsw-selected-swatch")?a.data("slug"):"";(a=a.closest(".cfvsw-swatches-container").prev().find("select")).val(s).change(),"inline"!==cfvsw_swatches_settings.html_design&&((t=(s=t).closest("tr").children(".label")).find(".cfvsw-selected-label").remove(),s.hasClass("cfvsw-selected-swatch"))&&(t.children("label").append('<span class="cfvsw-selected-label"></span>'),t.children("label").children(".cfvsw-selected-label").html(s.data("title")))}}),o("body").on("click",".cfvsw_ajax_add_to_cart.cfvsw_variation_found",function(s){s.preventDefault();{var e=o(this);if(e.is(".wc-variation-is-unavailable"))window.alert(cfvsw_swatches_settings.unavailable_text);else{let t=e.data("product_id"),a=e.attr("data-variation_id");a=parseInt(a),isNaN(t)||0===t||isNaN(a)||0===a||(s=e.attr("data-selected_variant"),s=JSON.parse(s),s={action:"cfvsw_ajax_add_to_cart",security:cfvsw_swatches_settings.ajax_add_to_cart_nonce,product_id:t,variation_id:a,variation:s},o(document.body).trigger("adding_to_cart",[e,s]),e.removeClass("added").addClass("loading"),o.ajax({type:"POST",url:cfvsw_swatches_settings.ajax_url,data:s,dataType:"json",success(t){t&&(t.error&&t.product_url?window.location=t.product_url:(o(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,e]),o(document.body).trigger("update_checkout"),e.removeClass("loading").addClass("added")))},error(t){e.removeClass("loading"),console.log(t)}}))}}}),o(document).on("change",".cfvsw-hidden-select select",function(){setTimeout(()=>{o(".cfvsw-hidden-select select").each(function(){let t=[];o(this).children("option").each(function(){""!==o(this).val()&&t.push(o(this).val())}),o(this).parent().next().find(".cfvsw-swatches-option").each(function(){-1===o.inArray(o(this).attr("data-slug"),t)?o(this).addClass(a):o(this).removeClass(a)})})},1)}),o(".reset_variations").on("click",function(){var t,a=o(this);o(".cfvsw-swatches-option").each(function(){o(this).removeClass("cfvsw-selected-swatch")}),o(".cfvsw-selected-label").remove(),cfvsw_swatches_settings.disable_out_of_stock&&(a=a.closest("table"),t=a.find("."+c),(a=a.find(".disable-to-select")).length&&a.removeClass("disable-to-select"),t&&t.removeClass(n),setTimeout(()=>{l.firstTime()},20))}),o(document).on({mouseenter(){var t=o(this),a=t.data("tooltip");""===a||void 0===a||t.hasClass("cfvsw-label-option")||0===t.children(".cfvsw-tooltip").length&&(t.prepend(`<div class="cfvsw-tooltip"><span class="cfvsw-tooltip-label">${a}</span></div>`),o(".cfvsw-tooltip").fadeIn(500),a=t.children(".cfvsw-swatch-inner").innerHeight(),o(".cfvsw-tooltip").css({bottom:a}),cfvsw_swatches_settings.tooltip_image)&&t.hasClass("cfvsw-image-option")&&(o(".cfvsw-tooltip").prepend("<span class='cfvsw-tooltip-preview'></span>"),t=t.children(".cfvsw-swatch-inner").css("backgroundImage"),o(".cfvsw-tooltip").css({bottom:a-30,padding:"2px"}),o(".cfvsw-tooltip-preview").css({backgroundImage:t,backgroundSize:"cover"}))},mouseleave(){o(".cfvsw-tooltip").remove()}},".cfvsw-swatches-option"),o(document).on("ready",function(){setTimeout(()=>{o(".cfvsw-hidden-select select").each(function(){var t=o(this).val();o(this).parent().next().find(`[data-slug='${t}']`).trigger("click")})},1),o(".woocommerce-widget-layered-nav-list").each(function(){o(this).find(".cfvsw-swatches-container").length&&o(this).addClass("cfvsw-filters")})}),o(".cfvsw-shop-variations").on("click",function(t){t.preventDefault()}),o(".cfvsw-shop-variations .cfvsw-more-link").on("click",function(t){window.location=t.target.href}),o(window).load(function(){s()}),l.init(),document.addEventListener("astraInfinitePaginationLoaded",function(){l.firstTime(),s()}),document.addEventListener("cfvswVariationLoad",function(){l.firstTime(),s()})}(jQuery);